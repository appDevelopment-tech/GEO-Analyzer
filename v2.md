# **GEO-Analyzer Report Flow Improvement Plan (v2.0)**

_Structured Report Engineering for AI Recommendation Readiness_

---

## **System Objective**

Transform the report system into a **governed, machine-actionable knowledge layer** that:

- Provides progressive disclosure (partial → full → tracking)
- Enables historical comparison and trend analysis
- Supports automated re-analysis with change detection
- Offers white-label agency capabilities
- Scales via automation without quality degradation

---

## **Current State Analysis**

**Existing Flow:**

```
URL Input → Crawl (8 pages) → AI Analysis → Supabase → Partial Display → Stripe → Email Report
```

**Strengths:**

- ✅ Conservative scoring with evidence-based citations
- ✅ Immediate partial report for UX
- ✅ Clean separation of concerns (crawler/analyzer/email)
- ✅ Apple-inspired UI design

**Pain Points:**

- ❌ No historical tracking or re-analysis
- ❌ Static email report (no interactivity)
- ❌ Single-use reports (no dashboard)
- ❌ No change detection between analyses
- ❌ Limited to 8 pages per analysis
- ❌ No progress tracking after fixes

---

## **PHASE 0 — Report Governance & Schema (FOUNDATION)**

### **0.1 Report Schema Standardization (2 hours)**

Define a canonical report schema that supports versioning:

```typescript
// types/report.ts
export interface CanonicalReport {
  report_id: string;
  version: string; // "1.0.0"
  domain: string;
  analysis_date: string;
  expiry_date: string; // 90 days

  // Scores
  overall_score: number;
  tier: Tier;
  section_scores: SectionScores;

  // Evidence
  top_ai_hesitations: Hesitation[];
  week1_fix_plan: FixPlan[];
  limitations: string[];

  // Governance
  liability_disclaimer: string;
  last_reviewed: string;
  sources_analyzed: number;

  // Metadata
  analysis_method: "multi_page" | "single_page";
  crawler_version: string;
}
```

### **0.2 Report Versioning & Rollback (2 hours)**

```typescript
export interface ReportVersion {
  report_id: string;
  version: number;
  created_at: string;
  superseded_by?: string;
  is_current: boolean;
  delta?: VersionDelta; // Changes from previous version
}

export interface VersionDelta {
  score_change: number;
  tier_change?: string;
  new_hesitations: string[];
  resolved_hesitations: string[];
}
```

**Rules:**

- Each new analysis creates a version
- Previous versions remain accessible
- Delta calculated automatically
- Rollback available for 30 days

---

## **PHASE 1 — Progressive Report Delivery (UX)**

### **1.1 Report Tiers (3 hours)**

Create three report levels with increasing depth:

| Tier         | Delivered Via        | Content                          | Purpose              |
| ------------ | -------------------- | -------------------------------- | -------------------- |
| **Partial**  | Browser (immediate)  | Score + tier + top 1 hesitation  | Conversion trigger   |
| **Standard** | Email (post-payment) | All hesitations + fix plan       | Actionable insights  |
| **Premium**  | Dashboard + API      | Historical tracking + benchmarks | Ongoing optimization |

### **1.2 Interactive Email Report (4 hours)**

Transform static email into interactive HTML:

```typescript
// lib/email-templates/interactive.ts
features:
- Expandable hesitation cards
- Click-to-fix recommendations
- "Re-analyze" button (triggers new crawl)
- "Share with team" link
- PDF export option
- Calendar integration for follow-up
```

**Template Structure:**

```
┌─────────────────────────────────────┐
│  Score Card (gradient, animated)    │
├─────────────────────────────────────┤
│  Quick Summary (3 bullet points)    │
├─────────────────────────────────────┤
│  [▶] Top Hesitations (collapsible)  │
│  [▶] Section Scores (detail view)   │
│  [▶] Week 1 Fixes (checklist)       │
├─────────────────────────────────────┤
│  [Re-analyze] [Share] [Export PDF]  │
└─────────────────────────────────────┘
```

### **1.3 Web Dashboard (6 hours)**

Create a user-facing dashboard:

**Pages:**

1. `/dashboard` - Overview of all reports
2. `/dashboard/[report-id]` - Full report with timeline
3. `/dashboard/compare` - Side-by-side comparison

**Features:**

- Score trend visualization (line chart)
- Hesitation resolution tracking
- Fix checklist with completion status
- Schedule re-analysis
- Export to CSV/PDF

---

## **PHASE 2 — Automated Follow-up & Re-analysis (RETENTION)**

### **2.1 Scheduled Re-analysis (4 hours setup)**

```typescript
// lib/scheduler.ts
export interface ReAnalysisSchedule {
  report_id: string;
  domain: string;
  interval: "7d" | "14d" | "30d" | "90d";
  active: boolean;
  next_run: string;
  notification_email: string;
}
```

**Automation:**

- Cron job checks for due re-analyses
- Triggers crawl → analyze → compare
- Sends delta report via email
- Updates dashboard with trend

### **2.2 Change Detection System (3 hours)**

```typescript
export interface AnalysisDelta {
  previous_score: number;
  current_score: number;
  change: number;
  trend: "improved" | "declined" | "stable";

  hesitations_added: number;
  hesitations_resolved: number;

  new_issues: string[];
  fixed_issues: string[];

  recommendation: string;
}
```

**Triggers for notification:**

- Score changes by >10 points
- Tier changes (e.g., Weak → Functional)
- New critical hesitation appears
- > 50% of Week 1 fixes completed

### **2.3 Fix Tracking (2 hours)**

Allow users to mark fixes as complete:

```typescript
export interface FixTask {
  id: string;
  report_id: string;
  task: string; // From week1_fix_plan
  status: "pending" | "in_progress" | "completed" | "verified";
  completed_at?: string;
  verified_by?: "user" | "re_analysis";
}
```

**Flow:**

1. User marks fix as complete
2. Optional: Request verification re-analysis
3. System confirms fix if score improves
4. Update dashboard progress

---

## **PHASE 3 — Quality & Validation Gates (MANDATORY)**

### **3.1 Pre-Report Validation (2 hours setup)**

Hard stop if:

```typescript
const VALIDATION_RULES = [
  { name: "min_pages", check: (data) => data.length >= 1 },
  {
    name: "has_hesitations",
    check: (score) => score.top_ai_hesitations.length > 0,
  },
  {
    name: "score_range",
    check: (score) => score.overall_score >= 0 && score.overall_score <= 100,
  },
  {
    name: "evidence_cited",
    check: (hesitations) => hesitations.every((h) => h.evidence.length > 0),
  },
  {
    name: "fix_plan_complete",
    check: (score) => score.week1_fix_plan.length === 5,
  },
];
```

### **3.2 Liability Disclaimer (MANDATORY)**

Add to every report (browser + email):

```
Important: This GEO analysis evaluates your website's AI recommendation readiness
based on publicly available content. It does not constitute SEO, legal, or business
advice. AI systems evolve rapidly and citation criteria are proprietary. Scores are
estimates based on current best practices.
```

### **3.3 Report Expiry (1 hour)**

```typescript
export interface ReportExpiry {
  created_at: string;
  expires_at: string; // 90 days
  status: "fresh" | "aging" | "expired";
  warning_threshold: 60; // days
}
```

**Behavior:**

- <60 days: "Fresh" indicator
- 60-90 days: "Aging" warning + re-analysis prompt
- > 90 days: "Expired" badge + re-analysis required

---

## **PHASE 4 — Agency & White-Label Features (MONETIZATION)**

### **4.1 White-Label Reports (4 hours)**

```typescript
export interface WhiteLabelConfig {
  agency_name: string;
  logo_url: string;
  primary_color: string;
  from_email: string;
  reply_to_email: string;
  custom_footer: string;
  hide_geo_branding: boolean;
}
```

**Implementation:**

- API endpoint for white-label generation
- Custom email templates with agency branding
- Optional: Custom domain for report links

### **4.2 Bulk Analysis (3 hours)**

```typescript
export interface BulkAnalysisJob {
  id: string;
  domains: string[];
  status: "pending" | "running" | "completed" | "failed";
  progress: number;
  results: BulkResult[];
}

export interface BulkResult {
  domain: string;
  score: number;
  tier: string;
  report_url: string;
}
```

**Flow:**

1. Upload CSV of domains
2. Queue for background processing
3. Email when complete
4. Download CSV with all results

### **4.3 API Access (4 hours)**

```typescript
// POST /api/v1/analyze
// GET /api/v1/reports/:id
// GET /api/v1/reports (list)
// POST /api/v1/reports/:id/reanalyze
```

**Rate Limits:**

- Free: 5/month
- Pro: 50/month
- Agency: 500/month

---

## **PHASE 5 — Schema & Machine Readability (TECHNICAL)**

### **5.1 Report JSON-LD (2 hours)**

Add structured data to report pages:

```json
{
  "@context": "https://schema.org",
  "@type": "Report",
  "name": "GEO Analysis Report",
  "about": {
    "@type": "WebSite",
    "url": "https://example.com"
  },
  "result": {
    "@type": "Rating",
    "ratingValue": 72,
    "bestRating": 100,
    "ratingExplanation": "AI-reference capable"
  },
  "dateCreated": "2026-01-26",
  "expires": "2026-04-26"
}
```

### **5.2 Export Formats (2 hours)**

Support multiple export formats:

- **PDF** (formatted, branded)
- **CSV** (raw data for analysis)
- **JSON** (machine-readable)

---

## **PHASE 6 — Measurement & Analytics (KPIs)**

Track:
| Metric | Description | Target |
|--------|-------------|--------|
| Report completion rate | % who finish checkout | >15% |
| Re-analysis rate | % who request follow-up | >20% |
| Fix completion | % of Week 1 fixes done | >30% |
| Score improvement | Avg delta on re-analysis | +10 pts |
| Agency adoption | White-label accounts | N/A |
| Report expiry response | % re-analyze after expiry | >25% |

---

## **PHASE 7 — Implementation Order (PRIORITY)**

| Phase                     | Effort | Priority | Dependencies |
| ------------------------- | ------ | -------- | ------------ |
| **0.1 Schema**            | 2h     | P0       | None         |
| **0.2 Versioning**        | 2h     | P0       | 0.1          |
| **1.2 Interactive Email** | 4h     | P0       | None         |
| **3.1 Validation**        | 2h     | P0       | None         |
| **3.2 Disclaimer**        | 1h     | P0       | None         |
| **1.3 Dashboard**         | 6h     | P1       | 0.2          |
| **2.1 Re-analysis**       | 4h     | P1       | 1.3          |
| **2.2 Change Detection**  | 3h     | P1       | 2.1          |
| **3.3 Expiry**            | 1h     | P1       | 0.2          |
| **2.3 Fix Tracking**      | 2h     | P2       | 1.3          |
| **4.1 White-Label**       | 4h     | P2       | 1.2          |
| **5.1 JSON-LD**           | 2h     | P2       | 1.3          |
| **4.2 Bulk Analysis**     | 3h     | P3       | 1.3          |
| **4.3 API**               | 4h     | P3       | 0.1          |

---

## **TOTAL IMPLEMENTATION TIME**

| Category              | Hours         |
| --------------------- | ------------- |
| Phase 0 (Governance)  | ~4 hours      |
| Phase 1 (Delivery)    | ~13 hours     |
| Phase 2 (Re-analysis) | ~9 hours      |
| Phase 3 (Quality)     | ~5 hours      |
| Phase 4 (Agency)      | ~11 hours     |
| Phase 5 (Schema)      | ~4 hours      |
| **TOTAL**             | **~46 hours** |

**Quick Wins (First Sprint - ~12 hours):**

1. Report schema standardization (0.1)
2. Report versioning (0.2)
3. Interactive email template (1.2)
4. Validation gates (3.1)
5. Liability disclaimer (3.2)

---

## **Supabase Schema Changes**

```sql
-- Add to existing Reports table
ALTER TABLE Reports ADD COLUMN version INTEGER DEFAULT 1;
ALTER TABLE Reports ADD COLUMN previous_report_id UUID REFERENCES Reports(id);
ALTER TABLE Reports ADD COLUMN delta JSONB;
ALTER TABLE Reports ADD COLUMN expires_at TIMESTAMP WITH TIME ZONE;
ALTER TABLE Reports ADD COLUMN crawler_version VARCHAR(50);

-- New table for fix tracking
CREATE TABLE fix_tasks (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  report_id UUID REFERENCES Reports(id),
  task TEXT NOT NULL,
  status VARCHAR(20) DEFAULT 'pending',
  completed_at TIMESTAMP WITH TIME ZONE,
  verified_by VARCHAR(20),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- New table for re-analysis schedules
CREATE TABLE re_analysis_schedules (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  report_id UUID REFERENCES Reports(id),
  domain TEXT NOT NULL,
  interval VARCHAR(10) NOT NULL,
  active BOOLEAN DEFAULT true,
  next_run TIMESTAMP WITH TIME ZONE,
  notification_email TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```
